{erl_opts, [{parse_transform, lager_transform}, {parse_transform, inheritor}, debug_info]}.
{erl_first_files, ["src/components/esp_stats.erl"]}.
%%{eunit_opts, [verbose]}.

{plugins,[
   rebar3_hex %, rebar_mix
%% ,
%%    { rebar3_elixir_compile, ".*", {git, "https://github.com/barrel-db/rebar3_elixir_compile.git", {branch, "master"}}}
]}.


{deps, [
   {lager, "3.7.0"},
   {carrot,             {git, "https://github.com/heyoka/carrot.git", {branch, "cleaner_events"}}},
   msgpack,
   {jiffy,              {git, "https://github.com/davisp/jiffy.git", {tag, "1.0.3"}}},
   {jsn,                {git, "https://github.com/heyoka/jsn.git", {branch, "free_the_array"}}},
   {dfs,                {git, "https://github.com/heyoka/dfs.git", {branch, "master"}}},
   {qdate,              {git, "https://github.com/choptastic/qdate.git", {branch, "master"}}},
   {cowboy,             {git, "https://github.com/ninenines/cowboy.git", {tag, "2.6.3"}}},
   {gun,                {git, "https://github.com/ninenines/gun.git", {tag, "1.3.2"}}},
   {pythra,             {git, "https://github.com/heyoka/pythra.git", {branch, "master"}}},
   {emqttc,             {git, "https://github.com/getong/emqttc.git", {tag, "v0.8.1"}}},
%%   {emqtt,              {git, "https://github.com/heyoka/emqtt.git", {branch, "master"}}},
   {snap7erl,           {git, "https://github.com/heyoka/snap7erl.git", {branch, "master"}}},
   {modbus,             {git, "https://github.com/heyoka/erlang-modbus", {branch, "master"}}},
   {folsom,             {git, "https://github.com/folsom-project/folsom", {branch, "master"}}},
   {epgsql,             {git, "https://github.com/epgsql/epgsql", {tag, "4.3.0"}}},
   {jamdb_oracle,       {git, "https://github.com/erlangbureau/jamdb_oracle", {branch, "master"}}},
   {uuid,               {git, "https://github.com/okeuday/uuid.git", {branch, "master"}}},
   {mapz,               {git, "https://github.com/eproxus/mapz.git", {branch, "master"}}},
   {digraph_export,     {git, "https://github.com/heyoka/digraph_export", {branch, "master"}}},
   {gen_smtp,           {git, "https://github.com/gen-smtp/gen_smtp.git", {branch, "master"}}},
   esq,
   {vmstats,            {git, "https://github.com/heyoka/vmstats.git", {tag, "2.4.0"}}}

]}.


{relx, [{release, { faxe, "0.8.5" },
         [sasl, lager, faxe,
          runtime_tools, wx, observer]},

        {sys_config, "config/sys.config"},
        {vm_args, "config/vm.args"},

        {dev_mode, true},
        {include_erts, false},

        {extended_start_script, true},

   {overlay, [
      {template, "config/sys.config", "releases/{{default_release_version}}/sys.config"},
      {template, "config/vm.args", "releases/{{default_release_version}}/vm.args"}
      ]}
   ]

}.

{profiles, [
   {dev1,
      [{relx, [{overlay_vars, "config/vars/dev1.config"}
         ,
         {sys_config_src, "config/sys.config.src"},
      {overlay, [
         {mkdir, "python"}, {mkdir, "templates"},
         {copy, "{{output_dir}}/lib/faxe-{{default_release_version}}/priv/email_template.html",
            "templates/email_template.html"}
      ]}
   ]}]},
   {dev2, [{relx, [{overlay_vars, "config/vars/dev2.config"}]}]},
   {dev3, [{relx, [{overlay_vars, "config/vars/dev3.config"}]}]},
   {dev4, [{relx, [{overlay_vars, "config/vars/dev4.config"}]}]},
   {dev5, [{relx, [{overlay_vars, "config/vars/dev5.config"}]}]},
   {balena, [
      {relx, [{overlay_vars, "config/vars/balena.config"},
         {sys_config, "config/balena/sys.config"},
         {vm_args, "config/balena/vm.args"},
         {overlay, [
            {template, "config/balena/sys.config", "releases/{{default_release_version}}/sys.config"},
            {template, "config/balena/vm.args", "releases/{{default_release_version}}/vm.args"},
            {mkdir, "python"}, {mkdir, "templates"},
            {copy, "{{output_dir}}/lib/faxe-{{default_release_version}}/priv/email_template.html",
               "templates/email_template.html"}
         ]},
         {dev_mode, false},
         {include_erts, true},
         {include_src, false}
      ]}]},
   {prod, [
      {relx, [{overlay_vars, "config/vars/prod.config"},
         {sys_config, "config/prod/sys.config"},
         {vm_args, "config/prod/vm.args"},
         {overlay, [
            {template, "config/prod/sys.config", "releases/{{default_release_version}}/sys.config"},
            {template, "config/prod/vm.args", "releases/{{default_release_version}}/vm.args"},
            {mkdir, "python"}, {mkdir, "templates"},
            {copy, "{{output_dir}}/lib/faxe-{{default_release_version}}/priv/email_template.html",
               "templates/email_template.html"}
         ]},
         {dev_mode, false},
         {include_erts, true},
         {include_src, false}
      ]}]},
   {k8s, [
      {relx, [
%%         {overlay_vars, "config/vars/k8s.config"},
         {sys_config_src, "config/k8s/sys.config.src"},
         {vm_args_src, "config/k8s/vm.args.src"},
         {overlay, [
%%            {template, "config/logi/sys.config", "releases/{{default_release_version}}/sys.config"},
%%            {template, "config/logi/vm.args", "releases/{{default_release_version}}/vm.args"},
            {mkdir, "python"}, {mkdir, "templates"},
            {copy, "{{output_dir}}/lib/faxe-{{default_release_version}}/priv/email_template.html",
               "templates/email_template.html"}
         ]},
         {dev_mode, false},
         {include_erts, true},
         {include_src, false},
         {debug_info, strip}
      ]}]},
   {logi, [
      {relx, [{overlay_vars, "config/vars/logi.config"},
         {sys_config, "config/logi/sys.config"},
         {vm_args, "config/logi/vm.args"},
         {overlay, [
            {template, "config/logi/sys.config", "releases/{{default_release_version}}/sys.config"},
            {template, "config/logi/vm.args", "releases/{{default_release_version}}/vm.args"},
            {mkdir, "python"}, {mkdir, "templates"},
            {copy, "{{output_dir}}/lib/faxe-{{default_release_version}}/priv/email_template.html",
               "templates/email_template.html"}
         ]},
         {dev_mode, false},
         {include_erts, true},
         {include_src, false}
      ]}]}
]}.
