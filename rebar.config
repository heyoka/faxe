{minimum_otp_vsn, "22"}.
{erl_opts, [{parse_transform, lager_transform}, {parse_transform, inheritor}, debug_info]}.
{eunit_opts, [verbose]}.
{erl_first_files, ["src/components/esp_stats.erl"]}.
{project_plugins, [ {rebar3_cuttlefish, {git, "https://github.com/heyoka/rebar3_cuttlefish", {branch, "faxe-0.1.0"}}}]}.
{plugins,[rebar3_hex]}.

{cuttlefish, [
   {schema_dir, "./priv"},
   {schema_discovery, true},
   {disable_bin_scripts, true}
]}.

{deps, [
   %{cuttlefish,         {git, "https://github.com/Kyorai/cuttlefish.git", {tag, "v2.3.0"}}},
   {lager, "3.7.0"},
   {carrot,             {git, "https://github.com/heyoka/carrot.git", {branch, "cleaner_events"}}},
   msgpack,
   {jiffy,              {git, "https://github.com/davisp/jiffy.git", {tag, "1.0.3"}}},
   {jsn,                {git, "https://github.com/heyoka/jsn.git", {branch, "free_the_array"}}},
   {dfs,                {git, "https://github.com/heyoka/dfs.git", {branch, "master"}}},
   {qdate,              {git, "https://github.com/choptastic/qdate.git", {branch, "master"}}},
   {cowboy,             {git, "https://github.com/ninenines/cowboy.git", {tag, "2.6.3"}}},
   {gun,                {git, "https://github.com/ninenines/gun.git", {tag, "1.3.2"}}},
   {pythra,             {git, "https://github.com/heyoka/pythra.git", {branch, "master"}}},
   {emqttc,             {git, "https://github.com/getong/emqttc.git", {tag, "v0.8.1"}}},
%%   {emqtt,              {git, "https://github.com/heyoka/emqtt.git", {branch, "master"}}},
   {snap7erl,           {git, "https://github.com/heyoka/snap7erl.git", {branch, "master"}}},
   {modbus,             {git, "https://github.com/heyoka/erlang-modbus", {branch, "master"}}},
   {folsom,             {git, "https://github.com/folsom-project/folsom", {branch, "master"}}},
%%   {exometer_core,      {git, "https://github.com/Feuerlabs/exometer_core", {branch, "master"}}},
   {epgsql,             {git, "https://github.com/epgsql/epgsql", {tag, "4.3.0"}}},
   {jamdb_oracle,       {git, "https://github.com/erlangbureau/jamdb_oracle", {branch, "master"}}},
   {uuid,               {git, "https://github.com/okeuday/uuid.git", {branch, "master"}}},
   {mapz,               {git, "https://github.com/eproxus/mapz.git", {branch, "master"}}},
   {digraph_export,     {git, "https://github.com/heyoka/digraph_export", {branch, "master"}}},
   {gen_smtp,           {git, "https://github.com/gen-smtp/gen_smtp.git", {branch, "master"}}},
   esq,
   {vmstats,            {git, "https://github.com/heyoka/vmstats.git", {tag, "2.4.0"}}}

]}.


{relx, [{release, { faxe, "0.9.0" },
         [sasl, lager, faxe,
          runtime_tools, wx, observer]},

%%        {sys_config, "config/sys.config"},
%%        {vm_args, "config/vm.args"},

        {dev_mode, true},
        {include_erts, false},
        {extended_start_script, true}
   ,
         {overlay_vars, "config/vars.config"},

   {overlay, [
      {template, "apps/faxe/priv/advanced.config", "{{output_dir}}/etc/advanced.config"}
%%      {template, "config/sys.config", "releases/{{default_release_version}}/sys.config"},
%%      {template, "config/vm.args", "releases/{{default_release_version}}/vm.args"}
      ]}
   ]

}.

{profiles, [
   {dev1,
      [{relx, [
         {overlay_vars, "config/vars/dev1.config"},
      {overlay, [
%%         {template, "apps/faxe/priv/advanced.config",
%%            "{{output_dir}}/etc/advanced.config"},
         {mkdir, "python"}, {mkdir, "templates"},
         {copy, "{{output_dir}}/lib/faxe-{{default_release_version}}/priv/email_template.html",
            "templates/email_template.html"}
      ]}
   ]}]},
   {dev2, [{relx, [{overlay_vars, "config/vars/dev2.config"}]}]},
   {dev3, [{relx, [{overlay_vars, "config/vars/dev3.config"}]}]},
   {dev4, [{relx, [{overlay_vars, "config/vars/dev4.config"}]}]},
   {dev5, [{relx, [{overlay_vars, "config/vars/dev5.config"}]}]},
   {balena, [
      {relx, [
         {overlay_vars, "config/vars/balena.config"},
         {overlay, [
%%            {template, "config/balena/sys.config", "releases/{{default_release_version}}/sys.config"},
%%            {template, "config/balena/vm.args", "releases/{{default_release_version}}/vm.args"},
            {mkdir, "python"}, {mkdir, "templates"},
            {copy, "{{output_dir}}/lib/faxe-{{default_release_version}}/priv/email_template.html",
               "templates/email_template.html"}
         ]},
         {dev_mode, false},
         {include_erts, true},
         {include_src, false}
      ]}]},
   {prod, [
      {relx, [
         {overlay_vars, "config/vars/prod.config"},
         {overlay, [
%%            {template, "config/prod/sys.config", "releases/{{default_release_version}}/sys.config"},
%%            {template, "config/prod/vm.args", "releases/{{default_release_version}}/vm.args"},
            {mkdir, "python"}, {mkdir, "templates"},
            {copy, "{{output_dir}}/lib/faxe-{{default_release_version}}/priv/email_template.html",
               "templates/email_template.html"}
         ]},
         {dev_mode, false},
         {include_erts, true},
         {include_src, false}
      ]}]},
   {k8s, [
      {relx, [
         {overlay_vars, "config/vars/k8s.config"},
         {overlay, [
            {mkdir, "python"}, {mkdir, "templates"},
            {copy, "{{output_dir}}/lib/faxe-{{default_release_version}}/priv/email_template.html",
               "templates/email_template.html"}
         ]},
         {dev_mode, false},
         {include_erts, true},
         {include_src, false},
         {debug_info, strip}
      ]}]},
   {azedge, [
      {relx, [

         {overlay, [
            {mkdir, "python"}, {mkdir, "templates"},
            {copy, "{{output_dir}}/lib/faxe-{{default_release_version}}/priv/email_template.html",
               "templates/email_template.html"}
         ]},
         {dev_mode, false},
         {include_erts, true},
         {include_src, false},
         {debug_info, strip}
      ]}]}

]}.
